phTagr

An image browser inspired by www.flickr.com. 

Main Idea: Browsing images by Tags/Keywords or searching images by Tags, Place,
Comment and Date while keeping the data in the single images through common
meta data blocks like IPTC.

A PHP frontend synchronize the images data with a SQL database. Adding images
via scp, rsync, http upload should be suporreted. Download raw images for
friends should be supported as well. Therefore, phTagr is a simple frontend for
your local images and can be used on your webpage as well.

Other image communities: http://holocore.com/?PictureSync_services


- PHP 
  - Generate valid XHTML. Mostly validated. Done.
  - All inputs must be checked for validity (prevent XCS and other intrusions)
    - Comments should not allow HTML tag: e.g.
      "<script>window.alert('intrusion');</script>". Done
  
- mySQL database
  - Add popular values as last view and current value. Done 2006-02-16
    Popular index = current value*0.8 + 0.2*(1/(current time+1 - last view))
    The value is updated every time if a image is clicked and only one per
    session. This function must be reviewed
  - Rename databases from singular to plural. Done
  - rename pref to conf. Done.
  - User
    - add creator: Id of the creator user. This is used to identify the user
      created guest account. Done.
    - add user type: Memeber or guest. Done.
    - add cookie: Replace the username=password cookie by a random value. Done.
    - add cookie expire. Done but has to be checked.
    - add expire. Done but has to be checked.
    - remove fsroot: Move this info to pref, since a user can have multiple
      roots. Done.
  - Image
    - Add duration: Seconds for a web video. Done.
    - Add HSV value: H, S, and V separated, used to identify/sort images by
      HSV. See http://en.wikipedia.org/wiki/HSV_color_space or
      http://en.wikipedia.org/wiki/HSL_color_space for more details. Done.
  - Comments
    - add reply-to-id, which is refering. Done.
    - add auth string for modifying, deleting comment. Done.
    - Add notify-by-email flag to send an email/message to the replied comment.
      Done. 
  - message
    A message can be used for intercommunication between phtagr users. E.g. for
    group invitations, plain messages, etc. Done.
    - Id: Message id
    - from: Id of creator
    - to: Id of recipient
    - date: Date of creation
    - expire
    - type: Message, Invitation, Invitation reply
    - private: private data for phtagr internal use. Indicates special actions
    - subject
    - body

- SqlObject: Represents a row, which is identified by an ID
  User, Image, Comment, Message can be inherited from it. Done.
  - _table
  - _data
  - init_by_id()
  - _get_param(name, default)
  - _set_param(param, value)
  - _store_param(param, value)
  - is_changed()
  - commit()
  - update()

- User
  Setting of a user account.
  - A admin account can create/modify/delete user accounts
    - A admin can set quotas, or other restrictions of users
    - At user creation, the user upload directory should be created and default
      values should be stored in the preference database. Root points the the
      upload directory.
    - At user deletion, all data of an user should be deleted
    - The deletion of the admin account is not permitted
    - Setup of admin settings
      - Allow creation of user
      - Default root directory (could depends on the username)
      - Allow browsing of file structure
      - Setup of user quota
      - Allow upload files by tar.gz
      - Allow download of files
      - Synchronize files with the database
      - Reset of tables (while developing the database structure)
  - A user can
    - have a user image which will be shown in the explorer
    - set the default ACLs and some image values like Name of Creator on
      uploading files
    - User can browse and reorder his uploaded images by directories (by
      chroot technique)
    - read the current quota
    - create/modifiy groups, which are assigned to images. A group is a list of
      other phtagr users, which will have special rights to specific images. 
  - Quota 
    A user can upload only a specific amount of data to its storage.
    - Default values are set by admin account.
    - Add quota, quotatime (how much can be uploaded in which time), and
      quotalimit (absolut quota)
  - Upload directory
    The Upload directory defines the storages place of the raw images of a
    specific user. Default place is set by admin account.
  - On login, users preferences are loaded from the preference database to the
    $_SESSION variables, overwritten by global values
  - A special user can be a GUEST. A guest has a username and a password. He is
    handle like an anonymous uses but can view all images of his assigned
    groups. A guest does not own images and has now quota.
  - To set a password, special requirement must fit. E.g. at least 6 chars, 2
    uperr and 2 lower chars, 2 speczial chars
    - Allow any password and add a Javascript function to indicate quality of 
      password

- Images
  An image is owned by an phTagr user. It could be places on any place for
  system users (e.g. /pub/images) or on the phTagr directory (e.g.
  /var/www/phtagr/data/<user>)
  - An image has a unique image id.
  - ACLs
    A user can set the specific access control to an image. The access levels
    are: Public, phTagr user, friends, or nobody but its own. 
    - Images are assigned to a group
  - A phTagr user can add a comment on a image (this information is not
    stored in a image itself)
  - Different views by tags
    Mosaic, Preview, Detail, Full size
  - Edit IPTC data
    Add or remove Keyword, Place, Time, Comment, Category by one-click
    - Change tags, sets, comment, time, acl, author at the bottom
    - Actions,
  - Advanced search
    by Tags, Comments, Date and Place
  - Number of views. If a image is viewed in detail the count is increased
  - Image object
    - contains exif and iptc data by database or by origial file.
      - array of tags(), commet, date, place, set, copyright, author, etc
    - read_exif()
      - if EXIF and IPTC information are not available, get height and width
        of an image
    - create different sizes
      - by GD, or ImageMagick
        - Check if GD keeps the EXIF and IPTC data
      - mosaic, 75x75, png
      - thumbnail, 250x250, jpg
      - preview, 800x600, jpg
      - high-resolution, 1024x786
      - original size
      - Insert of a watermark or copyright by IPTC copyright
    - get_imagesize for mini, thumb, and preview.
    - Save meta data in XML
      - Dublin core metadata initiative
      - store meta file filename.xml besides the original image or in
        subdirectory .phtagr 
      - Some meta data can be stored in IPTC, some not. Some phtagr specific
        data may not supported by dublin core meta. Save phtagr specific meta
        data in phtagr namespace
      - get_xml_meta($noiptc): Returns xml meta data. If set without IPTC data
      - save_xml_meta(): Reads meta data from xml
  - Download image
  - Add edit form to change IPTC tags
  - Replace voting by 5 stars. Each star is a direct vote link.
  - Add geo tags supported by google maps 
    - See tutorial: http://www.econym.demon.co.uk/googlemaps/
  - Add color table for images to search a image by color
  - Replace and improve the ranking function of the image
  - Add JavaScript Image Object with meta data to access them easily by JS
  - Add flag to write image changes only to the database. The image should not
    be affected. This option can be usefull for demo purpose
  
- Image Search: Search.php
  - By Set
  - By Caption content
  - Comment
    - Contains words
  - Set
  - Location
  - ACL
    - restrict images to public, phtagr acounts, friends and personal)
  - Create a Query class. Done. 2006-01-21
    - Tags. 
      - Operation AND, OR, FUZZY (75% match of tags)
    - Section
      - Page size
      - Page number
    - Time
      Enables search by date, inclusive links 1day [.], 1 week [-], 1 month [#]
      - Start time in UNIX timestamp
      - Interval length (3h, 1d, 1w, 1m)
    - function query_count() Returns total numbers. Done. 
    - function query_images() Returns a list of images ids
    - function from_URL and to_URL. Done.
    - clone function to create search URLs
  - Add JavaScript object of image with all important or meta data. This
    replaces complicated

- Comment
  An image can be commented by other users or memebers. The image ACL defines
  the access rights to add comments. The image owner can delete comments. The
  comment creator receives an authorization token to modify or delete his
  comment. The comments can be stored within the image in the JPEG comment
  block.
  - ID
  - Created
  - From
  - Name
  - Email
  - URL
  - Authorization: Authorization Code to delete or modify the comment
  - Body: Message body.

- Image Sets
  Images can be grouped by sets (or categories). Sets or categories are more
  general description than tags or keywords.
  - IPTC categories stores the sets

- FileBrowser
  Images can be added in a file browser. This option is available for local
  system users only.
  - Supports chroot-like browsing ()
  - Insert images of whole tree
    - default ACL, Tags, Comment, Copyright
  - Upload of tar balls. Done.
  - Creation of preview images. Done.
  - Add single images to add
  - Distinguish between files and directories
  - Add Icons to files and directories
    - Use created thumbnails of the JPG images

- FileSystem Object
  This object should handle all filesystem related operations like cd, mkdir,
  ls
  - Multiple root directories should be supported 
    - Windows has no real root directory, but drives. These drives are multiple
      root directories. 
    - On Linux, a normal user may browse his own home directory and its upload
      directory)
  - The roots of the file browser depends on the users roots directories
    - Only a phTagr user can browse their own upload directory
  - Array of root directories with aliases.
    - User can browse all its aliases
    - Aliases are loaded from at startup in $pref
    - Should the files be saved as aliases?
  - Supported functions
    - add_root($realpath, $alias): Add a root directory, which is accessable
    - cd($allow_symlink=false): Change of current directory
    - ls($pattern='*'): List of all files and dirs, returns array($dirs,
      $files)
    - get_dirs($pattern=''): returns all directories
    - get_files($pattern=''): returns all files
    - get_files_suppoted(): returns all supported image/video files
    - get_realname(): Returns real filename
    - mkdir($create_parrent=false): creates a directory
    - rm($pattern='*', $recursivly=false): remove files
    - touch(): update timestamp of file
    - con_dir($parent, $child): concardinate two dirs

- Session
  - Session Protection (http://www.php-center.de/faq/faq-version4_session.html)
    The session id provides a server-side checks of previous requests and
    enables the storage of session based data like visited links, downloaed
    images, etc and. Therefore it is important that the session id is available
    for mostly every request.
    - At the first visit a new session with a session id will be created. The
      session id is stored in a temporary cookie on the client side. 
    - If no session id is available only the welcome page is shown.
      - What is about rewritten links like /phtagr/tags/foo ?
    - If no cookies are available add the session id to all links and
      formulars. This is also the case for the first visit.
  - Cookie
    - Stores MD5 ID for authentication
    - Stores the login time. This can be used to show new images since the last
      login
    - Add several values to the cookie like (<name>=<value>;)+
      - login
      - visited
      - lang
      - theme
  - Remember visited image. This information will be used for counting the
    clicks on the images. Done.
  - Storing of users preferences. These are loaded at a session beginning or
    preference changes
  - Selection of images to download, or edit 
  - Init the session by a cookie if it is available. Done 2006-03-11.
  - Save and transmit password in MD5
  - Secure and improve the login by adding turing test image
  - Support HTTPS

- configuration
  + user
    + gacl, oacl, oacl
    + theme
    + lang
    + fsroot[]
    + image
  + path
    + htdocs
    + phtagr 
    + data
  + cmd
    + convert

- Accounts
  - Verify a account creation by an image
    - Save value of image in the session
  - Set default values
    - root
    - policy
    - ACL
    - Upload

- Setup/Installation
  - Easy setup of phTagr via HTML. 
    - An other aproach is to have a single configuration page. E.g. Creation
      tables and the admin account at one step.
  - Connection to the SQL databas
  - Creation of SQL tables
  - Creation of the admin account
  - If a configuration file is copied to another place, the installation
    procedure should skip these topic and should initialize the table and the
    admin account.

- Themes
  - Diffent themes by CSS

- Additional 
  - Images can be uploaded to an flickr account
  - Support RSS infos about new images or comments
  - Support previews in a link for the own homepage. This link lists a few
    photos randomly in a user defined table (like in flickr)
  - Support anonymous as cookie (Language, theme, etc)
  - Greeting Cards
  - Messages
    Simple messages can be used to inform users or to send messages to users
    - id
    - Created: Creation time of the message
    - expire: Valid time of the message
    - type
      - Message between users 
      - Autorisation Request of group invation
      - Greeting Card
      - Admin information
    - FromUser: ID of creator
    - ToUser: ID of receiver
    - message: Message body
    - data: Additional custom data for parameters

- Explorer
  - Add clicks to database
    - Add popular value by last click time and a delta function. 
  - Add IPTC place and set to images if they are available
  - Add all used tags of the preview windows in a sidebar
  - Remove the last comma in the tag list
  - Edit date by offset e.g. +1Y to add 1 year, -3D5h substract 3 days and 5
    hours.
  - Add checkboxes to images to add collaborative image edit
  - Add total count of previewed images
  - Enable AJAX update of image properties. 
  - JavaScript: Add link of current page as parameter
  - If comment is too long in the thumbnail view, short it by dots "..."
  - Enable Dia Show to current search via JavaScript
  - Support diffent views
    - 3 column table
    - minimized table for editing

- Multi Language Support
  - use gettext() and *.mo files

- Support Video Files
  - Use flash movies like YouTube or video.google
  - Convert videos from avi, mpeg, or mov to flv via ffmpeg and fvltool2 (see
    http://blog.go4teams.com/?p=56)
  - Should we split the image table to generic file table with image and video
    table?

Already done:
Home:
- Add List of 100 popular Tags in the home section with an random image. Done
  2006-01-18 by Sebastian 
Titlebar:
- Add Search function in the title bar. Done 2006-01-21 by sebastian
  - Add multiple tag search. Done 2006-01-21 by sebastian
- Login and logout should generate meaningful page generation. The logout
  action shows the first time as a authenticated session. Done 2006-01-21 by
  sebastian
- Move login and logout to the account section as action. Done 2006-01-20 by
  sebastian 

